function setFunction(a){pixelOperationFunction=a}function init(){v=document.getElementById("v"),canvas=document.getElementById("mycanvas"),gCtx=canvas.getContext("2d"),navigator.webkitGetUserMedia({video:!0},callbackStreamIsReady)}function callbackStreamIsReady(a){v.src=URL.createObjectURL(a),v.play(),window.requestAnimationFrame(draw)}function draw(){var a=canvas.clientWidth,b=canvas.clientHeight;backBuffer.width=a,backBuffer.height=b,bCtx.drawImage(v,0,0,a,b),pixelOperationFunction(a,b),window.requestAnimationFrame(draw)}function passInverse(a,b){for(var c=bCtx.getImageData(0,0,a,b),d=c.data,e=0;e<d.length;e+=4){var f=d[e+0],g=d[e+1],h=d[e+2],i=parseInt((f+g+h)/3),j=255-i;i=j,d[parseInt(e+0)]=i,d[parseInt(e+1)]=i,d[parseInt(e+2)]=i,d[parseInt(e+3)]=255}c.data=d,gCtx.putImageData(c,0,0)}function passGray(a,b){for(var c=bCtx.getImageData(0,0,a,b),d=c.data,e=0;e<d.length;e+=4){var f=d[e+0],g=d[e+1],h=d[e+2],i=parseInt((f+g+h)/3);d[parseInt(e+0)]=i,d[parseInt(e+1)]=i,d[parseInt(e+2)]=i,d[parseInt(e+3)]=255}c.data=d,gCtx.putImageData(c,0,0)}function passNormal(a,b){var c=bCtx.getImageData(0,0,a,b);gCtx.putImageData(c,0,0)}function passRed(a,b){for(var c=bCtx.getImageData(0,0,a,b),d=c.data,e=0;e<d.length;e+=4)d[parseInt(e+1)]=0,d[parseInt(e+2)]=0,d[parseInt(e+3)]=255;c.data=d,gCtx.putImageData(c,0,0)}function passEmboss(a,b){for(var c=bCtx.getImageData(0,0,a,b),d=c.data,e=0;e<d.length;e+=4){var f=d[e+0],g=d[e+1],h=d[e+2],i=parseInt((f+g+h)/3);if(e>7){mOld=d[e-8+0],mOld=d[e-8+1],mOld=d[e-8+2];var j=255-i;i=j,mNew=parseInt((mOld+i)/2),d[e-8+0]=mNew,d[e-8+1]=mNew,d[e-8+2]=mNew}}c.data=d,gCtx.putImageData(c,0,0)}var requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;window.requestAnimationFrame=requestAnimationFrame;var v,canvas,gCtx,pixelOperationFunction=passNormal,backBuffer=document.createElement("canvas"),bCtx=backBuffer.getContext("2d");angular.module("hueCinemaApp",["ngCookies","ngResource","ngSanitize","ngRoute"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("hueCinemaApp").controller("MainCtrl",["$scope","Hueservice","Camservice",function(a,b,c){a.minUpdateFreq=500;var d=localStorage.getItem("bridgeurl");d&&$("#bridgeurl").val(d),a.saveIP=function(){var a=$("#bridgeurl").val();console.log("SAVE IP: "+a),localStorage.setItem("bridgeurl",a),b.setHueBridge(a)},a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"],a.dataTimer=null,console.log("controller is here"),a.sayHello=function(a){console.log(a)},a.setHueColor=function(a,c,d){b.setHueColor(a,c,d).then(function(a){console.log(a)})},a.getHueList=function(){console.log("HUEs"),b.getHueList().then(function(b){console.log(b),Object.keys(b).forEach(function(a){console.log(a,b[a]),b[a].slide="500",b[a].prevslide="500"}),console.log(b),a.lights=b,$("#btn-rec").removeClass("disabled"),a.checkLightFreq=window.setInterval(a.submitLightFreq,1e3)})},a.submitLightFreq=function(){var b=a.minUpdateFreq;Object.keys(a.lights).forEach(function(c){var d=a.lights[c].slide,e=a.lights[c].prevslide;b>d&&(b=d),e!=d&&(a.lights[c].prevslide=d,console.log("new slide value! update!"))}),b<a.minUpdateFreq&&(console.log(" *** UPDATE RECORD FREQ ***"),a.minUpdateFreq=b,console.log(a.minUpdateFreq))},a.record=function(){"Record Screen"==$("#btn-rec").text()?($("#btn-rec").text("stop Record"),c.startRecord().then(function(c){console.log(c),b.startLightning(a).then(function(a){console.log(a)})}),a.dataTimer=window.setInterval(a.deliverData,500)):($("#btn-rec").text("Record Screen"),c.stopRecord().then(function(a){console.log(a),b.stopLightning().then(function(a){console.log(a)})}),window.clearInterval(a.dataTimer))},a.deliverData=function(){var d=c.getAvgColor(),e=new Array;$("input:checkbox[name=huelisthome]:checked").each(function(){e.push($(this)[0].value)});for(var f=0;f<e.length;f++)a.lights[e[f]].slide!=a.lights[e[f]].prevslide&&(console.log("new slide value! update!"),a.lights[e[f]].slide=a.lights[e[f]].prevslide);b.setHueColor(d.r,d.g,d.b,e)}}]),angular.module("hueCinemaApp").directive("yo",function(){return{template:"<div></div>",restrict:"E",link:function(a,b){b.text("this is the yo directive")}}}),angular.module("hueCinemaApp").service("Camservice",["$q","$timeout",function(a,b){var c,d,e=903,f=document.querySelector("video"),g=document.getElementById("mycanvas"),h=function(){var a=g.getContext("2d");a.drawImage(f,0,0,320,240),d=i()},i=function(){var a,b,c,d,e=document.getElementById("mycanvas"),f=2,g={r:0,g:0,b:0},h=document.createElement("canvas"),i=h.getContext&&h.getContext("2d"),j=-4,k={r:0,g:0,b:0},l=0;if(!i)return g;c=h.height=e.height||e.offsetHeight||e.height,b=h.width=e.width||e.offsetWidth||e.width,i.drawImage(e,0,0);try{a=i.getImageData(0,0,b,c)}catch(m){return alert("x"),g}for(d=a.data.length;(j+=4*f)<d;)++l,k.r+=a.data[j],k.g+=a.data[j+1],k.b+=a.data[j+2];return k.r=~~(k.r/l),k.g=~~(k.g/l),k.b=~~(k.b/l),k},j=function(){return d},k=function(){if(null!=navigator.webkitGetUserMedia){var d={video:!0,audio:!0};navigator.webkitGetUserMedia(d,function(a){f.src=window.webkitURL.createObjectURL(a)},function(){console.log("error happened")})}var g=a.defer();return c=window.setInterval(h,e),b(function(){g.resolve(["recording",!0,e])},1),g.promise},l=function(){f.pause(),f.src="";var d=a.defer();return window.clearInterval(c),b(function(){d.resolve(["stop recording",!0])},1),d.promise};return{startRecord:k,stopRecord:l,updateCam:h,getAvgColor:j}}]),angular.module("hueCinemaApp").service("Hueservice",["$http","$q","$timeout",function(a,b,c){var d,e=903,f="",g=new Object;g.r=0,g.g=0,g.b=0;var h,i=function(a){f=a+"lights/"},j=function(){return f},k=function(){var c=b.defer(),d=f;return console.log("baseurl: "+d),a.get(d).success(c.resolve).error(c.reject),c.promise},l=function(c,d,e,h){var i=b.defer();g.r=c/100*255,g.g=d/100*255,g.b=e/100*255;var j=tinycolor(g).toHsl();console.log(j);for(var k=0;k<h.length;k++){var l=f+h[k]+"/state",m={on:!0,sat:Math.floor(255*j.s),bri:Math.floor(255*j.l),hue:Math.floor(j.h%360*182)};a.put(l,m).success(i.resolve).error(i.reject)}return i.promise},m=function(){console.log("update lights"),console.log(h)},n=function(a){var f=b.defer();return h=a,d=window.setInterval(m,e),c(function(){f.resolve(["lightning",!0,e])},1),f.promise},o=function(){var a=b.defer();return window.clearInterval(d),c(function(){a.resolve(["stop lightning",!0])},1),a.promise};return{setHueBridge:i,getHueBridge:j,getHueList:k,setHueColor:l,startLightning:n,stopLightning:o,updateLights:m}}]),angular.module("hueCinemaApp").service("Userprovider",function(){});